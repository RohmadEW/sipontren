

    angular.module('mainApp').controller('mdJkController', function ($scope, formHelper, notificationService, $routeParams, $http, $mdDialog, dataScopeShared) {
        $scope.mainURI = $routeParams.ci_dir + '/' + $routeParams.ci_class;
        $scope.ajaxRunning = true;
        $scope.dataUpdate = dataScopeShared.getData('DATA_UPDATE');
        $scope.addForm = true;

        $scope.formData = {
            ID_JK: null,
            NAMA_JK: null,
            KODE_EMIS_JK: null,
        };
        
        $http.get($scope.mainURI + '/form').then(callbackForm, notificationService.errorCallback);

        function callbackForm(response) {
            callbackFormData(response);
        }

        function callbackFormData(response) {
            if ($scope.dataUpdate === null || typeof $scope.dataUpdate === 'undefined')
                formReady();
            else
                getData();
        }

        function getData() {
            $http.post($scope.mainURI + '/view', $scope.dataUpdate).then(callbackSuccessData, notificationService.errorCallback);
        }

        function callbackSuccessData(response) {
            $scope.formData.ID_JK = response.data.ID_JK;
            $scope.formData.NAMA_JK = response.data.NAMA_JK;
            $scope.formData.KODE_EMIS_JK = response.data.KODE_EMIS_JK;

            $scope.addForm = false;

            formReady();
        }

        function formReady() {
            $scope.ajaxRunning = false;
        }

        $scope.cancelSumbit = function () {
            dataScopeShared.addData('DATA_UPDATE', null);
            $mdDialog.cancel();
        };

        $scope.saveSubmit = function () {
            if ($scope.form.$valid) {
                $scope.ajaxRunning = true;

                $http.post($scope.mainURI + '/save', $scope.formData).then(callbackSuccessSaving, notificationService.errorCallback);
            } else {
                notificationService.toastSimple('Silahkan periksa kembali masukan Anda');
            }
        };

        function callbackSuccessSaving(response) {
            $scope.ajaxRunning = false;
            $mdDialog.hide(response.data.notification.text);
            dataScopeShared.addData('DATA_UPDATE', null);
        }
    });